<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Student Support System</title>
  <style>
    :root { color-scheme: light dark; --bg:#0b1020; --panel:#151a2b; --muted:#8fa3c0; --accent:#3b82f6; }
    body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Noto Sans, "Apple Color Emoji", "Segoe UI Emoji"; background:#0b1020; color:#e5ecff; }
    header { padding:16px 20px; background:#0d1326; border-bottom:1px solid #1f2942; position:sticky; top:0; }
    header h1 { margin:0; font-size:18px; letter-spacing:.3px; }
    main { max-width:960px; margin:20px auto; padding:0 16px; display:grid; grid-template-columns: 1fr; gap:16px; }
    .card { background:#151a2b; border:1px solid #1f2942; border-radius:12px; padding:16px; }
    .card h2 { font-size:16px; margin:0 0 10px 0; color:#cfe0ff; }
    textarea, input[type="number"], input[type="text"] { width:100%; background:#0f1426; color:#e5ecff; border:1px solid #223053; border-radius:8px; padding:10px 12px; outline:none; }
    textarea { min-height:90px; resize:vertical; }
    .row { display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; }
    button { background:#3b82f6; color:white; border:none; border-radius:8px; padding:10px 14px; cursor:pointer; font-weight:600; }
    button:disabled { opacity:.6; cursor:not-allowed; }
    .output { margin-top:12px; white-space:pre-wrap; color:#e9f1ff; border-left:3px solid #3b82f6; padding-left:10px; }
    footer { text-align:center; padding:20px; color:#8fa3c0; font-size:12px; }
    .muted { color:#8fa3c0; font-size:12px; margin-top:6px; }
    @media (min-width: 880px) { main { grid-template-columns: 1fr 1fr; } .span-2 { grid-column: span 2; } }
  </style>
  <script>
    async function postJSON(url, body) {
      const res = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
      if (!res.ok) { const text = await res.text(); throw new Error(text || res.statusText); }
      return await res.json();
    }

    async function sendChat() {
      const input = document.getElementById('chat-input');
      const out = document.getElementById('chat-output');
      const riskOut = document.getElementById('chat-risk-output');
      const btn = document.getElementById('chat-btn');
      const msg = input.value.trim();
      if (!msg) return;
      btn.disabled = true; out.textContent = 'Thinking...'; riskOut.textContent = '';
      try {
        const data = await postJSON('/api/chat/', { message: msg });
        out.textContent = data.reply || 'No reply.';
        // Also get a heuristic wellbeing score from the same message
        const r = await postJSON('/api/risk/from_chat', { message: msg });
        riskOut.textContent = `Wellbeing score: ${(r.wellbeing_score * 100).toFixed(1)}%\n${r.recommendation}`;
      } catch (e) { out.textContent = 'Error: ' + e.message; }
      finally { btn.disabled = false; }
    }

    async function scoreRisk() {
      const attendance = parseFloat(document.getElementById('att').value || '0');
      const gpa = parseFloat(document.getElementById('gpa').value || '0');
      const missed = parseInt(document.getElementById('miss').value || '0');
      const out = document.getElementById('risk-output');
      const btn = document.getElementById('risk-btn');
      btn.disabled = true; out.textContent = 'Scoring...';
      try {
        const data = await postJSON('/api/risk/score', { features: { attendance_rate: attendance, gpa: gpa, missed_assignments: missed }});
        out.textContent = `Estimated risk: ${(data.risk * 100).toFixed(1)}%`;
      } catch (e) { out.textContent = 'Error: ' + e.message; }
      finally { btn.disabled = false; }
    }
  </script>
  <link rel="icon" href="data:," />
  <meta name="robots" content="noindex" />
  <meta name="color-scheme" content="dark light" />
  <meta name="description" content="Prototype UI for AI Student Support" />
  <meta http-equiv="Cache-Control" content="no-store" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>
  <header>
    <h1>AI Student Support System</h1>
  </header>
  <main>
    <section class="card">
      <h2>Wellbeing Chat</h2>
      <textarea id="chat-input" placeholder="Share what's on your mind..."></textarea>
      <div style="display:flex; gap:10px; margin-top:10px;">
        <button id="chat-btn" onclick="sendChat()">Send</button>
        <span class="muted">Requires Ollama running locally (model set by server)</span>
      </div>
      <div id="chat-output" class="output"></div>
      <div id="chat-risk-output" class="output"></div>
    </section>

    <section class="card">
      <h2>Risk Estimator</h2>
      <div class="row">
        <div>
          <label class="muted">Attendance (0 - 1)</label>
          <input id="att" type="number" min="0" max="1" step="0.01" value="0.8" />
        </div>
        <div>
          <label class="muted">GPA (0 - 4)</label>
          <input id="gpa" type="number" min="0" max="4" step="0.1" value="2.5" />
        </div>
        <div>
          <label class="muted">Missed Assignments</label>
          <input id="miss" type="number" min="0" step="1" value="5" />
        </div>
      </div>
      <div style="margin-top:10px;">
        <button id="risk-btn" onclick="scoreRisk()">Calculate Risk</button>
      </div>
      <div id="risk-output" class="output"></div>
    </section>

    <section class="card span-2">
      <h2>About</h2>
      <div class="muted">Prototype for student wellbeing chat and dropout risk estimation. Not for clinical use.</div>
    </section>
  </main>
  <footer>
    © Prototype — Local only
  </footer>
  <script>
    // Optionally auto-run health check to ensure backend is up
    fetch('/health').catch(()=>{});
  </script>
  </body>
  </html>


